<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BRICHBUY - Buscador de Productos</title>
</head>
<body>
  <h1>Bienvenido a BRICHBUY</h1>
  <p>Importamos y enviamos cualquier producto desde China, EE. UU. y mÃ¡s.</p>

  <h2>Busca tu producto</h2>
  <input type="text" id="busqueda" placeholder="Escribe aquÃ­... (ej. nike cortez)">
  <button onclick="buscar()">Buscar</button>

  <h3>Resultados:</h3>
  <div id="resultados">AquÃ­ aparecerÃ¡n los productos...</div>

  <script>
    async function traducir(texto) {
      const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=es&dt=t&q=${encodeURIComponent(texto)}`;
      const res = await fetch(url);
      const data = await res.json();
      return data[0][0][0];
    }

    async function buscar() {
      const texto = document.getElementById('busqueda').value;
      const query = encodeURIComponent(texto);
      const apiKey = '5d91a58517074d7aa379a0c43f7c0325ac00c919004b35f99036784885881ee9';

      // ðŸ”“ Proxy CORS para evitar bloqueos
      const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(
        `https://serpapi.com/search.json?engine=google_shopping&q=${query}&api_key=${apiKey}&hl=es&tbm=shop`
      )}`;

      document.getElementById('resultados').innerHTML = 'Buscando...';

      try {
        const res = await fetch(url);
        const data = await res.json();
        const items = data.shopping_results || [];

        let html = '';
        for (const item of items.slice(0, 5)) {
          const tituloTraducido = await traducir(item.title);
          html += `
            <div style="border:1px solid #ccc; margin:10px; padding:10px;">
              <img src="${item.thumbnail}" width="100"><br>
              <strong>${tituloTraducido}</strong><br>
              Precio: ${item.price}<br>
              <a href="${item.link}" target="_blank">Ver producto</a>
            </div>
          `;
        }

        document.getElementById('resultados').innerHTML = html || 'No se encontraron productos.';
      } catch (err) {
        alert('ERROR: ' + err.message);
        document.getElementById('resultados').innerText = 'Error: ' + err.message;
        console.error('Error completo:', err);
      }
    }
  </script>
</body>
</html>
